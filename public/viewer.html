<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Viewer</title>
</head>
<body>
<h2>Viewer</h2>
<video id="local" autoplay muted style="width:300px;"></video>

<script>
const pc = new RTCPeerConnection();
const channel = pc.createDataChannel("control");

async function start() {
  const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
  document.getElementById("local").srcObject = stream;
  stream.getTracks().forEach(t => pc.addTrack(t, stream));

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);

  await fetch("/api/signal?action=offer", {
    method: "POST",
    body: JSON.stringify(offer)
  });

  const waitAnswer = async () => {
    const res = await fetch("/api/signal");
    const data = await res.json();

    if (data.answer) {
      await pc.setRemoteDescription(data.answer);
    } else {
      requestAnimationFrame(waitAnswer);
    }
  };

  waitAnswer();
}

start();
</script>
</body>
</html>
